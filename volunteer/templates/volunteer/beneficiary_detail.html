{% extends "base.html" %}
{% load static %}
{% load crispy_forms_tags %}

{% block head_title %}
Beneficiary Details
{% endblock head_title %}

<!-- Beneficiary detail goes here -->

{% block content %}

<div class="container">
    <div class="row">
        <div class="col-6 p-2">
            <h2>{{ beneficiary.beneficiary_name }}</h2>
            <p>{{ beneficiary.description | safe }}</p>
            <p>
                <span>Slots reserved: {{ slots_created_count }}</span>
                <span>Slots completed: {{ slots_completed_count }}</span>
            </p>
        </div>
        <!--List of published slots (and all reserved by current user) goes here-->
        <div class="col-6 p-2">
            <h2>Sample tasks for this beneficiary:</h2>
            {% for slot in slots %}
            <div>
                {% if slot.publish_ok %}
                <p class="slot-display"> Task: {{ slot.task }}
                    | Location: {{ slot.task_location }}</p>
                {% elif not slot.publish_ok and slot.reserved_by == user %}
                <p class="slot-display">
                    <span class="fw-bold faded">{{ slot.reserved_by }}</span>
                    <span class="text-secondary"> Task: {{ slot.task }} | Location:
                        {{ slot.task_location }} Date: {{ slot.date }}</span>
                </p>
                <p>This task has not been published but still
                    appears on your dashboard. You can edit or delete the task here
                    or manage it on your dashboard.
                </p>
                {% endif %}
                {% if user.is_authenticated and slot.reserved_by == user %}
                <button type="button" class="btn btn-secondary btn-edit" slot_id="{{ slot.id }}">
                    Edit
                </button>
                {% endif %}
            </div>
            {% endfor %}
        </div>
    </div>
</div>
<!--------------------------Reserving slots------------>
<div class="container">
    <div class="row">
        <div class="col-12 mx-auto p-2">
            <h2>Add a task related to this beneficiary to your dashboard</h4>
                <h3>Tasks can be managed on your dashboard.</h3>
                <h4>If you plan to volunteer on multiple dates for the same beneficiary,
                    go ahead and add multiple times here.
            </h2>
            {% if user.is_authenticated %}
            <p class="graduate-bold">Reservation for: username {{ user.username }}</p>
            <form id="slotForm" method="POST">
                {{ form | crispy }}
                {% csrf_token %}
                <button id="submitButton" type="submit" class="btn btn-secondary btn-lg">Save to Dashboard</button>
            </form>
            {% else %}
            <p>Log in to save a slot
                <a href="{{ login_url }}" value="login">Log In</a>
            </p>
            {% endif %}
        </div>
    </div>
</div>

{% endblock content %}

{% block extras %}
<script src="{% static 'js/slots.js' %}"></script>
{% endblock %}

</body>